# Stage 6 - Target Code Generation

## Description

This stage implements x86 assembly code generation from TAC (Three-Address Code) instructions generated in Stage 5. The generator translates each type of TAC instruction into equivalent sequences of x86 assembly instructions.

## Main Files

- `asm.hpp` - Assembly generator interface
- `asm.cpp` - Assembly generator implementation
- `main.cpp` - Main program integrated with assembly generation
- `Makefile` - Updated to include assembly generator compilation
- `relatorio.md` - Report with details of the implementation and tests, written in Portuguese
- `tests/` - Directory containing test files for the assembly generator
- `output/` - Directory for output files generated by the assembly generator

## How to Use

### Compilation

To compile the project, run:

```bash
make
```

or

```bash
make etapa6
```

To compile one of the test files, you can use:

```bash
make test FILE=<test_file>
```

When running with `make test`, it will compile all the source codes and generate in the `output/` directory all the detailed intermediate data structures involved in the compilation process:

- Symbol table in `output/<test_file>_symbol_table.txt`
- AST structure in `output/<test_file>_AST.txt`
- Decompiled code from AST in `output/<test_file>_decompiled.txt`
- TAC instructions in `output/<test_file>_TAC.txt`
- Generated assembly file in `output/<test_file>.s`

It will also call the `gcc` command to compile the generated assembly code into an executable, which will be saved in `output/<test_file>.out`.

After this, the command will run the generated executable.

### Execution

After compiling, you can run this command to generate the assembly code from a 2025++1 source file:

```bash
./etapa6 <input_file> <symbol_table_output> <ast_output> <decompiled_output> <tac_output> <assembly_output>
```

**Parameters:**

- `input_file`: Source file in 2025++1 language
- `symbol_table_output`: Symbol table output file
- `ast_output`: AST structure output file
- `decompiled_output`: Decompiled code from AST
- `tac_output`: TAC instructions output file
- `assembly_output`: Generated assembly file

### Usage Example

```bash
# Compile complete example
./etapa6 tests/functions.2025++1 output/functions_symbol_table.txt output/functions_AST.txt output/functions_decompiled.txt output/functions_TAC.txt output/functions.s

# Compile assembly to executable
gcc output/functions.s -o output/functions.out
```

## Code Architecture

### AssemblyGenerator Functions

- **generateASM()**: Main function that processes TAC list
- **processInstruction()**: Handles specific TAC instruction types
- **Helper functions**: Utility functions for allocation and manipulation
- **Type detection**: Identifies real vs integer variables for proper handling

## File Structure

- `scanner.l`: Lexical analyzer specification
- `parser.ypp`: Syntactic analyzer grammar
- `ast.hpp` and `ast.cpp`: Abstract Syntax Tree implementation
- `symbol.hpp` and `symbol.cpp`: Symbol table management
- `verifications.hpp` and `verifications.cpp`: Semantic analysis implementation
- `tac.hpp` and `tac.cpp`: Three Address Code generation implementation
- `asm.hpp` and `asm.cpp`: Assembly code generation implementation
- `main.cpp`: Program entry point
- `Makefile`: Compilation instructions
- `spect6.pdf`: PDF with the specification of this stage, in portuguese
- `relatorio.md`: Report with details of the implementation and tests, in portuguese
- `tests/`: Directory with test files for the assembly generator
- `output/`: Directory for output files generated by the assembly generator
